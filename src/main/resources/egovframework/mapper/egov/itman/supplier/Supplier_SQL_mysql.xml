<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="supplierDAO">
    <sql id="supplierCondition">
        WHERE   DEL_YN = 'N'
        AND GRO_IDX = #{searching.groIdx}
        <if test="searching.searchKeyword != null and searching.searchKeyword != ''">
        <choose>
            <when test="searching.searchCondition == 'supName'">
            AND SUP_NAME LIKE CONCAT('%', #{searching.searchKeyword}, '%')
            </when>
            <when test="searching.searchCondition == 'supBnum'">
            AND SUP_BNUM LIKE CONCAT('%', #{searching.searchKeyword}, '%')
            </when>
            <when test="searching.searchCondition == 'supMail'">
            AND SUP_MAIL LIKE CONCAT('%', #{searching.searchKeyword}, '%')
            </when>
            <when test="searching.searchCondition == 'supTel'">
            AND SUP_TEL LIKE CONCAT('%', #{searching.searchKeyword}, '%')
            </when>
            <otherwise>
                AND (
                SUP_NAME LIKE CONCAT('%', #{searching.searchKeyword}, '%')
                OR SUP_BNUM LIKE CONCAT('%', #{searching.searchKeyword}, '%')
                OR SUP_MAIL LIKE CONCAT('%', #{searching.searchKeyword}, '%')
                OR SUP_TEL LIKE CONCAT('%', #{searching.searchKeyword}, '%')
                )
            </otherwise>
        </choose>
        </if>
    </sql>

    <select id="selectSupplierList" parameterType="pagination" resultType="supplierVO">
        SELECT
            ROW_NUMBER() OVER(ORDER BY SUP_IDX) AS rowNum,
            SUP_IDX AS supIdx,
            SUP_NAME AS supName,
            SUP_BNUM AS supBnum,
            SUP_MAIL AS supMail,
            SUP_TEL AS supTel
        FROM
            ITM_SUPPLIER
        <include refid="supplierCondition"/>
        ORDER BY rowNum DESC;
    </select>

    <select id="selectSupplyView" parameterType="supplierVO" resultType="supplierVO">
        SELECT
        SUP_IDX AS supIdx,
        SUP_NAME AS supName,
        SUP_BNUM AS supBnum,
        SUP_MAIL AS supMail,
        SUP_TEL AS supTel
        FROM
        ITM_SUPPLIER
        WHERE   DEL_YN = 'N'
          AND SUP_IDX = ${supIdx}
    </select>

    <select id="selectSupplierListCnt" parameterType="pagination" resultType="int">
        SELECT
            COUNT(*)
        FROM
            ITM_SUPPLIER
        <include refid="supplierCondition"/>
    </select>

    <select id="selectSuppliersByGroup" parameterType="string" resultType="supplierVO">
        SELECT
        SUP_IDX AS supidx,
        SUP_NAME AS supName
        FROM ITM_SUPPLIER
        WHERE
            DEL_YN = 'N'
          AND GRO_IDX = #{groIdx}

        ORDER BY SUP_NAME
    </select>

    <insert id="insertAssetSupplier" parameterType="supplierVO">
        INSERT INTO
        ITM_SUPPLIER
        <trim prefix="(" suffix=")" suffixOverrides=",">
            GRO_iDX,
            SUP_CODE,
            SUP_NAME,
            SUP_BNUM,
            REG_DATE,
            REG_IDX,
            <if test="supTel != null and supTel.trim().length() > 0">SUP_TEL,</if>
            <if test="supMemo != null and supMemo.trim().length() > 0">SUP_MEMO,</if>
            <if test="supMail != null and supMail.trim().length() > 0">SUP_MAIL,</if>

        </trim>
        VALUES
        <trim prefix="(" suffix=")" suffixOverrides=",">
            #{groIdx},
            #{supCode},
            #{supName},
            #{supBnum},
            NOW(),
            #{regIdx},
            <if test="supTel != null and supTel.trim().length() > 0">#{supTel},</if>
            <if test="supMemo != null and supMemo.trim().length() > 0">#{supMemo},</if>
            <if test="supMail != null and supMail.trim().length() > 0">#{supMail},</if>
        </trim>
    </insert>

    <update id="updateSupply" parameterType="supplierVO">
        UPDATE
            ITM_SUPPLIER
        SET
            SUP_NAME = #{supName},
            SUP_BNUM = #{supBnum},
            SUP_MAIL = #{supMail},
            SUP_TEL = #{supTel},
            MOD_DATE = NOW(),
            MOD_IDX = #{modIdx}
        WHERE
            SUP_IDX = #{supIdx}
    </update>

    <update id="deleteSupply" parameterType="supplierVO">
        UPDATE
            ITM_SUPPLIER
        SET
            DEL_YN = 'Y',
            DEL_DATE = NOW(),
            DEL_IDX = #{delIdx}
        WHERE
            SUP_IDX = #{supIdx}
    </update>

</mapper>